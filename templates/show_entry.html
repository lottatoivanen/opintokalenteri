<html>

<head>
  <title>{{ entry.title }}</title>
</head>

<link rel="stylesheet" href="/static/main.css">

<body class="center-page">
    {% if session.username %}
    <header class="top-bar">
        <h1 class="top-bar-title">Opintokalenteri</h1>
        <br>
        <nav class="top-bar-actions">
        <a class="btn btn--ghost" href="/">Etusivu</a>
        <a class="btn btn--ghost" href="/new_course">Lisää kurssi</a>
        <a class="btn btn--ghost" href="/new_entry">Uusi merkintä</a>
        <a class="btn btn--ghost" href="/find_entry">Etsi merkintä</a>
        <a class="btn btn--ghost" href="/all_courses">Muiden käyttäjien kurssit</a>
        <a class="btn btn--ghost" href="/user/{{ session.username }}">Omat sivut</a>
        <a class="btn btn--ghost" href="/logout">Kirjaudu ulos</a>
        </nav>
    </header>

    <header class="form-top-bar">
        <h2 class="form-top-bar-title">{{ entry.title }}</h2>
    </header>

    <p>
        <b>Kuvaus:</b> <br />
        {{ entry.description }}
    </p>
    <br>
    <p>
        <b>Aikaraja:</b> {{ entry.date }}
    </p>
    <br>
    <p>
        <b>Lisännyt käyttäjä:</b> <a href="/user/{{ entry.username }}">{{ entry.username }}</a>
    </p>
    <br>
    <p>
        <b>Kurssi:</b>
        {% if entry.course_name %}
            <a href="/course/{{ entry.course_id }}">{{ entry.course_name }}</a>
        {% else %}
            Ei kurssia
        {% endif %}
    </p>
    <br>
    <p>
        <b>Kategoriat:</b>
        {% if tags %}
            {% for title, value in tags %}
            <li>{{ value }}</li>
            {% endfor %}
        {% else %}
            Ei kategorioita
        {% endif %}
    </p>
    <br>
        {% if owner %}
        <a href="/edit_entry/{{ entry.id }}" class="btn btn--small">Muokkaa merkintää</a>
        <a href="/delete_entry/{{ entry.id }}" class="btn btn--small">Poista merkintä</a>
        {% endif %}

    <br>

    <div class="comment-box">
    <form class="form-style" action="/add_comment_entry/{{ entry.id }}" method="post">
        <input type="hidden" name="entry_id" value="{{ entry.id }}">
        <h3>Kommentoi merkintään</h3>
        <br>
        <p>
            <textarea name="comment" rows="4" cols="50" required></textarea>
        </p>
        <br>
        <p>
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
            <input type="submit" value="Lähetä kommentti" class="btn btn--small"/>
        </p>
        <br>
    </form>
    <h3>Kommentit</h3>
    <p>
        {% if comments %}
            <ul>
            {% for comment in comments %}
                <div class="comment">
                    <div class="author"><a href="/user/{{ comment.username }}">{{ comment.username }}</a></div>
                    <div class="date">{{ comment.date }}</div>
                    <div class="content">{{ comment.comment }}</div>
                    {% if session.user_id == comment.user_id %}
                        <form action="/delete_comment/{{ comment.id }}" method="POST" style="display:inline;">
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <input type="hidden" name="entry_id" value="{{ entry.id }}">
                            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                            <button type="submit" class="btn btn--smallwhite">Poista kommentti</button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}
            </ul>
        {% else %}
            Ei kommentteja.
        {% endif %}
    </p>
    </div>
    <br>
    <p><a href="/" class="btn btn--small">Takaisin etusivulle</a></p>
    {% endif %}

    {% if not session.username %}
        <header class="top-bar">
            <h1 class="top-bar-title">Opintokalenteri</h1>
            <nav class="top-bar-actions">
            <a class="btn btn--ghost" href="/login">Kirjaudu sisään</a>
            <a class="btn btn--ghost" href="/register">Rekisteröidy</a>
            </nav>
        </header>
    {% endif %}
</body>

</html>
